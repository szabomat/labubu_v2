<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>Labubu vadászat</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f1221">
<link rel="apple-touch-icon" href="icon-192.png">
<style>
body,html{margin:0;padding:0;height:100%;background:#0f1221;color:#fff;font-family:sans-serif;}
#menu,#overlay{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);}
#menu.hidden,#overlay.hidden{display:none;}
button{margin:6px;padding:10px 16px;border-radius:8px;border:0;font-weight:bold;}
#game{display:block;width:100%;height:100%;}
#timer{position:fixed;top:10px;left:50%;transform:translateX(-50%);font-weight:bold;font-size:20px;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="timer"></div>
<div id="menu">
  <h2>Labubu vadászat</h2>
  <div>
    <p>Időlimit</p>
    <button class="time" data-t="20">20 mp</button>
    <button class="time" data-t="30">30 mp</button>
    <button class="time" data-t="45">45 mp</button>
  </div>
  <div>
    <p>Nehézség</p>
    <button class="diff" data-d="slow">Könnyű</button>
    <button class="diff" data-d="medium">Közepes</button>
    <button class="diff" data-d="fast">Nehéz</button>
  </div>
  <button id="start">Start</button>
</div>
<div id="overlay" class="hidden"><h1 id="msg"></h1><button id="again">Újra</button></div>
<script>
const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');let W,H,dpr=window.devicePixelRatio||1;
function resize(){W=canvas.width=innerWidth*dpr;H=canvas.height=innerHeight*dpr;canvas.style.width=innerWidth+'px';canvas.style.height=innerHeight+'px';ctx.setTransform(1,0,0,1,0,0);ctx.scale(dpr,dpr);}resize();addEventListener('resize',resize);
let goodColors=['#ff4757','#1e90ff','#2ed573','#ffa502','#a55eea','#ff6b81'];
let badColor='#000000';
let labubus=[],collected=new Set(),running=false,timer=30,difficulty='medium',speedFactor=2,startTime;
let overlay=document.getElementById('overlay'),msg=document.getElementById('msg');
let menu=document.getElementById('menu'),timerEl=document.getElementById('timer');
let audioCtx=null;function initAudio(){if(!audioCtx){audioCtx=new (window.AudioContext||window.webkitAudioContext)();}}
function playSound(type){if(!audioCtx)return;let now=audioCtx.currentTime;let o=audioCtx.createOscillator();let g=audioCtx.createGain();o.connect(g).connect(audioCtx.destination);
if(type==='good'){o.type='triangle';o.frequency.setValueAtTime(440,now);g.gain.setValueAtTime(.3,now);g.gain.exponentialRampToValueAtTime(.001,now+.3);}
if(type==='bad'){o.type='sawtooth';o.frequency.setValueAtTime(120,now);g.gain.setValueAtTime(.4,now);g.gain.exponentialRampToValueAtTime(.001,now+.5);}
if(type==='win'){[440,660,880].forEach((f,i)=>{let o2=audioCtx.createOscillator();let g2=audioCtx.createGain();o2.type='sine';o2.frequency.setValueAtTime(f,now+i*0.2);g2.gain.setValueAtTime(.3,now+i*0.2);g2.gain.exponentialRampToValueAtTime(.001,now+.5+i*0.2);o2.connect(g2).connect(audioCtx.destination);o2.start(now+i*0.2);o2.stop(now+.7+i*0.2);});}
if(type==='lose'){o.type='square';o.frequency.setValueAtTime(200,now);g.gain.setValueAtTime(.3,now);g.gain.exponentialRampToValueAtTime(.001,now+.7);}
o.start(now);o.stop(now+1);}
function createLabubu(color,isBad=false){let r=20;let x=Math.random()*(innerWidth-2*r)+r;let y=Math.random()*(innerHeight-2*r)+r;let v= speedFactor;let vx=(Math.random()-.5)*v*4;let vy=(Math.random()-.5)*v*4;return{color,isBad,x,y,vx,vy,r,spawn:Date.now()};}
function reset(){labubus=[];collected.clear();running=true;startTime=Date.now();overlay.classList.add('hidden');menu.classList.add('hidden');for(let i=0;i<5;i++){let col=goodColors[Math.floor(Math.random()*goodColors.length)];labubus.push(createLabubu(col,false));}}
function endGame(message,type){running=false;msg.textContent=message;overlay.classList.remove('hidden');playSound(type);}
canvas.addEventListener('pointerdown',e=>{initAudio();let rect=canvas.getBoundingClientRect();let x=(e.clientX-rect.left);let y=(e.clientY-rect.top);labubus.forEach(l=>{if(!l.collected){let d=Math.hypot(l.x-x,l.y-y);if(d<l.r){if(l.isBad){endGame('Game Over!','bad');}else{l.collected=true;collected.add(l.color);playSound('good');if(collected.size===labubus.filter(b=>!b.isBad).length){endGame('Nyertél!','win');}}}}});});
function loop(){if(!running)return;ctx.clearRect(0,0,innerWidth,innerHeight);labubus.forEach((l,i)=>{if(!l.collected){l.x+=l.vx;l.y+=l.vy;if(l.x<l.r||l.x>innerWidth-l.r)l.vx*=-1;if(l.y<l.r||l.y>innerHeight-l.r)l.vy*=-1;ctx.beginPath();ctx.fillStyle=l.color;ctx.arc(l.x,l.y,l.r,0,Math.PI*2);ctx.fill();ctx.fillStyle='#000';ctx.beginPath();ctx.arc(l.x-6,l.y-4,3,0,Math.PI*2);ctx.arc(l.x+6,l.y-4,3,0,Math.PI*2);ctx.fill();ctx.fillStyle='#fff';ctx.fillRect(l.x-4,l.y+4,8,3);} });let elapsed=(Date.now()-startTime)/1000;let remain=timer-elapsed;timerEl.textContent=Math.ceil(remain);if(remain<=0){endGame('Idő lejárt!','lose');}if(Math.random()<0.01){labubus.push(createLabubu(badColor,true));}labubus=labubus.filter(l=>!(l.isBad&&(Date.now()-l.spawn>4000)));requestAnimationFrame(loop);}
document.querySelectorAll('.time').forEach(b=>b.onclick=()=>{timer=parseInt(b.dataset.t)});
document.querySelectorAll('.diff').forEach(b=>b.onclick=()=>{difficulty=b.dataset.d;if(difficulty==='slow')speedFactor=1;else if(difficulty==='medium')speedFactor=2;else speedFactor=3;});
document.getElementById('start').onclick=()=>{reset();loop();};
document.getElementById('again').onclick=()=>{menu.classList.remove('hidden');overlay.classList.add('hidden');};
</script>
</body>
</html>
